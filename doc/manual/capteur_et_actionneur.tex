\chapter{Capteur et actionneur}
\authors{
  \authorinfo{Romain}{Marchaudon} \\
  \authorinfo{Johnny}{Phor}\\
  \authorinfo{Salwa}{Bahji}\\
  \authorinfo{Alexandre}{Ouazan} \\
  \authorinfo{Chunlin}{Zhu}

}

\section{Commande des gaz}
\subsection{Description et contexte}

	Pour la commande des gazs on veut être capable de contrôler les moteurs et le trim . On souhaite avoir accès aux commandes en position et en détection de dépassement de couple.

	Nous souhaitons être capable d'envoyer, d'une part, vers FSUIPC les différentes positions des servomoteurs et dans le sens FSUIPC vers les AX12, autrement dit le mode pilote automatique,  les servomoteurs doivent être capables de se positionner à des angles bien précis. 
Pour cela on doit interfacer les servomoteurs avec le bus CAN. On doit donc adapter les formats de trames, venant des servomoteurs ou venant du bus CAN, afin que ces deux entités puissent communiquer entre elles.

Pour la réalisation des commandes de gaz nous utiliserons des Servomoteur Dynamixel AX12. Les AX12 sont pilotés par une liaison série et peuvent être reliés l'un à l'autre pour créer une chaîne de servomoteurs .Nos 3 servomoteurs peuvent donc cohabiter sur un même bus.
Ces moteurs ont une résolution de 1024 pas en position et une vitesse de rotation réglable également sur 1024 pas. En lecture, il est possible de connaître, entre autres, leur position courante et leur couple ce qui correspond bien à nos besoins.

\subsection{Conception fonctionnelle}

Quand on étudie la documentation du Servomoteur Dynamixel, on remarque que ce dernier peut être contrôlé par un PC via un CM-5.
Le CM-5 possède un circuit interne qui permet de convertir les signaux en half-duplex. Le diagramme réalisant cette conversion est \ref{fig:half_duplex}:

\begin{figure}[htpb]
  \centering
  \fbox{
    \includegraphics[scale=0.5]{images/half_duplex}
  }
  \caption{half_duplex}
  \label{fig:half_duplex}
\end{figure}

On souhaite donc, que les signaux, de niveaux TTL, RxD et TxD dépendent du signal Direction-Port.
Lorsque le signal Direction-Port est au niveau haut, le signal TxD en sortie représentera DATA et lorsque, le signal Direction-Port est au niveau bas, le signal DATA est l'entrée du signale RxD.
On constate donc qu'on peut s'affranchir du CM5, d'une part à cause de son coût élevé et d'une autre part pour notre propre apprentissage, en réalisant une carte électrique qui produirait cette fonctionnalité du CM5.

Pour cela on pourra utiliser un GALisp22V10, qu'on implémentera via Abel.
D'autre part le GAL fonctionne avec des niveaux TTL alors que le port série fonctionne avec des niveaux logiques 1 et 0, notre carte d'interface devra également générer des niveaux TTL. Pour cela on pourra utiliser un MAX232, qui amplifie et met en forme deux entrées et deux sorties TTL/MOS vers deux entrées et deux sorties RS232. 
Cette carte nous permettra également d'obtenir le signal data nécessaire pour le servomoteur AX12 en sortie du circuit GALisp22V10, qui est également à un niveau TTL.

\subsection{Developpement et problèmes rencontrés}
La programmation du circuit GALisp22v10, a était faite en langage Abel à l'aide du logiciel Lattice IspDesignExpert, cf.ANNEXE Abel GAL, afin de réaliser la fonction half-duplex, expliquée dans la partie précèdente.
Les chronogrammes, en l'ANNEXE Chronogrammes GAL, montre bien que la fonction réalise bien son rôle.

Pour la réalisation de la carte qui fait office d'interface entre le port rs232 et le servomoteur, nous avons opté pour un MAX233, car ce dernier éxige moins de condensateurs, ce qui facilite le routage du MAX232, qui lui possède 5 condensateurs, et ceci tout en gardant les mêmes propriétés.

Pour l'alimentation de la carte, nous avons utilisé un régulateur 7805T, capable de fournir une tension stable de 5v (output) en sortie afin d'alimenter le circuit GAL et le MAX233 et d'avoir une tension de l'ordre de 9.6v (input) pour l'alimentation des AX12 \ref{fig:7805}:

\begin{figure}[htpb]
  \centering
  \fbox{
    \includegraphics[scale=0.5]{images/7805}
  }
  \caption{7805}
  \label{fig:7805}
\end{figure}
